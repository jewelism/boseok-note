## 이벤트루프 (Event Loop)

js는 싱글스레드인데 동시에 많은 이벤트들을 어떻게 처리할까?

이벤트루프는 js의 메인스레드이고 싱글스레드이다.

이벤트루프는 콜스택과 태스크큐를 지켜보고있다가 콜스택이 비어있으면

태스크큐에서 첫번째 이벤트를 콜스택에 넣어주는 일을하고, 그것을 tick이라고한다.

결국 자바스크립트는 싱글스레드이므로 block되는 코드가 존재한다면 그냥 block된다.

이 말은 동시에 뭔가 할수없다는 것인데, 브라우저에서 ui가 그려지는것을

어떤 로직때문에 화면에 그려지는게 막히면 안된다.

그래서 비동기 api가 존재하는 것이고, 대표적으로 아래의 web api이다.

[web API](../api/web-api.md) - DOM, xhr, timeout

이것들은 개발자가 접근할수없는, 호출만 가능한 스레드이다. (C++ API)

별도의 스레드에서 처리하는 것은 아니다.

```js
function sleep(delay) {
  var start = Date.now();
  while (Date.now() < start + delay);
}
console.log(0);
setTimeout(() => {
  console.log(2);
  sleep(1000);
  console.log(3);
}, 0);
sleep(3000);
console.log(1);
```
위의 코드를 보면, web api가 별도스레드에서 실행된다고 가정하면,

0이 처음에 찍히고, 123이 순서대로 동시에 찍혀야하는데,

3초후에 1, 2가 동시에 찍히고 1초후에 3이 찍힌다.

이것은 별도스레드에서 작동하는게 아니라,

싱글스레드인 이벤트루프와 큐를 통해 작동하고 있는 것을 확인할 수 있다.

어차피 나중에 코드가 실행되는 것이므로, web api에 무거운 로직이 들어가서

오래걸리는게 싫다면 아래의 워커 api를 사용하면 된다.

[worker API](../api/worker-api.md)

이것은 js의 싱글스레드의 한계를 극복할수있게 도와주는 api이다.

별도의 워커스레드에서 스크립트를 실행한다.